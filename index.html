<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8"/>
        <title>Autômato</title>
    </head>
    <body>
        <input type="file" name="file" id="file" /> <!--carregar arquivo local do computador-->
        <script>
            document.getElementById('file').onchange = function(){ //ler elemento html com ID==file
                var file = this.files[0]; //declaração variável file que vai receber o arquivo carregado no input
                var reader = new FileReader(); //declaração variável reader que tem método FileReader para ler arquivo
                reader.onload = function(progressEvent){   //inicia variavel reader com uma função  
                    var fileContentArray = this.result.split(/\r\n|\n/); //variavel fileContentArray que é um array onde cada valor é uma linha do arquivo. pega o resultado do arquivo e divide ele quanto achar \n ou quebra de linha
                    for(var line = 0; line < fileContentArray.length; line++){ //laço for para ler cada linha. começa com a linha 0 até ser menor que o tamanho do array de fileContentArray
                        document.write("["); //por algum motivo precisa ser separado do resto. há coisas na vida de programador que só aceitamos
                        document.write(line+1 +"] "+ fileContentArray[line] + "<br>"); //mostra conteúdo
                    }
                    document.write("<br>");
                    var error = new Array(); //erros
                    var id = new Array(); //identificadores
                    let i = 0;
                    for(var line = 0, j = 0; line < fileContentArray.length; line++){ //laço for para ler cada linha. começa com a linha 0 até ser menor que o tamanho do array de fileContentArray
                        let word = fileContentArray[line];
                        let pattern = /^int$|^double$|^float$|^real$|^break$|^case$|^char$|^const$|^continue$/;
                        let result = pattern.test(word);
                        if(result){
                            document.write("["); //por algum motivo precisa ser separado do resto. há coisas na vida de programador que só aceitamos
                            document.write(line+1 +"] "+ word.toUpperCase() + "<br>");
                        }else if(!result){
                            pattern = /^[a-zA-Z]+|^[a-zA-Z][0-9]+/;
                            result = pattern.test(word);
                            if(result){
                                let l = id.length;
                                if(l == 0){
                                    id[0] = fileContentArray[line];
                                }else{
                                    for(i = 0; i <= l; i++){
                                        if(fileContentArray[line] == id[i]){
                                            break;
                                        }else if(i == l){
                                            id[i] = fileContentArray[line];
                                            break;
                                        }
                                    }
                                }
                                i++;
                                document.write("["); //por algum motivo precisa ser separado do resto. há coisas na vida de programador que só aceitamos
                                document.write(line+1 +"] IDENTIFICADOR "+ i + "<br>");
                            }else{
                                pattern = /^[0-9]{1,2}[.][0-9]{1,2}$|^[0-9]{1,2}[.][0-9]{1,2}[/]{2}|^[0-9]{1,2}[.][0-9]{1,2}\s[/]{2}/;
                                result = pattern.test(word);
                                if(result){
                                    let l = id.length;
                                    if(l == 0){
                                        id[0] = fileContentArray[line];
                                    }else{
                                        for(i = 0; i <= l; i++){
                                            if(fileContentArray[line] == id[i]){
                                                break;
                                            }else if(i == l){
                                                id[i] = fileContentArray[line];
                                                break;
                                            }
                                        }
                                    }
                                    i++;
                                    document.write("["); //por algum motivo precisa ser separado do resto. há coisas na vida de programador que só aceitamos
                                    document.write(line+1 +"] NÚMERO REAL " + i + "<br>");                                
                                }else{
                                    pattern = /^[0-9]{1,2}$|^[0-9]{1,2}\s[/]{2}|^[0-9]{1,2}[/]{2}/;
                                    result = pattern.test(word);
                                    if(result){
                                        let l = id.length;
                                        if(l == 0){
                                            id[0] = fileContentArray[line];
                                        }else{
                                            for(i = 0; i <= l; i++){
                                                if(fileContentArray[line] == id[i]){
                                                    break;
                                                }else if(i == l){
                                                    id[i] = fileContentArray[line];
                                                    break;
                                                }
                                            }
                                        }
                                        i++;
                                        document.write("["); //por algum motivo precisa ser separado do resto. há coisas na vida de programador que só aceitamos
                                        document.write(line+1 +"] NÚMERO INTEIRO " + i + "<br>");
                                    }else{
                                        pattern = /[/]{2}/;
                                        result = pattern.test(word);
                                        if(result){
                                            document.write("["); //por algum motivo precisa ser separado do resto. há coisas na vida de programador que só aceitamos
                                            document.write(line+1 +"] COMENTÁRIO <br>");
                                        }
                                    }
                                }
                            }
                        }else{
                            error[j] = line+1 + " (" + fileContentArray[line] + ")";
                            j++;
                        }
                    }
                    document.write("<br>");
                    if(error){
                        document.write("Erros nas linhas: <br>")
                        for(i = 0; i < error.length; i++){
                            document.write(error[i] + "<br>");
                        }
                    }
                };
                reader.readAsText(file); //chamando função de leitura do arquivo com o arquivo que foi enviado no input
            };
        </script>
    </body>
</html>